{% extends "sidebar.html" %}

{% block content %}
<h1 class="title" style="margin-top: 0;">
    {{ section.title }}
</h1>
{{ section.content | safe }}

{% set blog = get_section(path="blog/_index.md") %}
{% set passerine = get_section(path="passerine/_index.md") %}
{% set gallery = get_section(path="gallery/_index.md") %}

{% set all_pages = blog.pages | concat(with=passerine.pages) | concat(with=gallery.pages) | sort(attribute="date") | reverse %}

{% set_global current_year = "" %}
{% set_global year_count = 0 %}
{% for page in all_pages %}
    {% set page_year = page.date | date(format="%Y") %}
    {% if page_year != current_year %}
        {% if current_year != "" %}</ul>{% endif %}
        {% set_global year_count = 0 %}
        {% for p in all_pages %}{% if p.date | date(format="%Y") == page_year %}{% set_global year_count = year_count + 1 %}{% endif %}{% endfor %}
        <h1>{{ page_year }} ({{ year_count }} post{{ year_count | pluralize }})</h1>
        <ul style="padding-left: 0;">
        {% set_global current_year = page_year %}
    {% endif %}
    <li style="list-style: none;">
        <span class="tag">{{ page.date }}</span>
        <span class="pill">
            <a class="tag" href="{% if page.permalink is containing("/blog/") %}/blog{% elif page.permalink is containing("/passerine/") %}/passerine{% elif page.permalink is containing("/gallery/") %}/gallery{% endif %}">
                {% if page.permalink is containing("/blog/") %}Blog{% elif page.permalink is containing("/passerine/") %}Passerine{% elif page.permalink is containing("/gallery/") %}Gallery{% endif %}
            </a>
        </span>
        <a href="{{ page.permalink | safe }}">{{ page.title }}</a>
        <span class="tag">{{ page.reading_time }}&nbsp;min.</span>
    </li>
{% endfor %}
{% if current_year != "" %}</ul>{% endif %}
{% endblock content %}

{% block sidebar %}
{{ macros::artbit(image=section.extra.artbit) }}
{% endblock %}
